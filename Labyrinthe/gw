Yes â€” jâ€™ai une idÃ©e ğŸ™‚

Alerte Gatewatcher Â« ET SHELLCODE Possible Call with (No) Offset TCP Shellcode Â»

Ce sont des signatures Emerging Threats (Suricata) qui cherchent un motif trÃ¨s classique de shellcode x86 :
un CALL $+5 (octet E8 00 00 00 00) suivi dâ€™un POP (58 ou 8F). Câ€™est la technique GetPC (call-pop) utilisÃ©e pour rÃ©cupÃ©rer lâ€™adresse courante dans le shellcode.  ï¿¼ ï¿¼ ï¿¼

ConcrÃ¨tement : Ã§a dÃ©clenche dÃ¨s quâ€™un flux TCP contient cette sÃ©quence dâ€™octets, mÃªme si câ€™est juste un binaire lÃ©gitime en transit (maj jeux/VM/AV, dÃ©pÃ´ts Debian, etc.). Il y a donc pas mal de faux positifs documentÃ©s.  ï¿¼ ï¿¼ ï¿¼

Ã€ noter : lâ€™Ã©quipe ET a dÃ©sactivÃ© rÃ©cemment plusieurs de ces rÃ¨gles Ã  cause du bruit (SIDs TCP : 2012086, 2012088, 2012090, 2012092 ; UDP : 2012087, 2012089, 2012091, 2012093). VÃ©rifie ta version de ruleset et si ces SIDs sont encore actifs chez toi.  ï¿¼

Triage rapide (pragmatique)
	1.	Identifie le SID exact, le 5-tuple et le sens du flux.
	2.	Reconstitue le flux dans Gatewatcher (ou PCAP) et regarde le Content-Type : tÃ©lÃ©chargement HTTP(S) dâ€™un EXE/MAJ/CDN connu â‡’ souvent FP.
	3.	Cherche la sÃ©quence E8 00 00 00 00 58/8F dans le payload pour confirmer le match.  ï¿¼
	4.	CorrÃ¨le : dâ€™autres alertes (ex. â€œPE EXE or DLL downloadâ€) + rÃ©putation du domaine/IP.
	5.	DÃ©cision :
	â€¢	Si lÃ©gitime : suppression ciblÃ©e (par SID + destination/source) ou dÃ©sactivation globale des SIDs â€œNo Offset â€¦â€ sâ€™ils sont trop bruyants.
	â€¢	Si doute/hostile (exploit vers un service interne, piÃ¨ce jointe malveillante, etc.) : isole lâ€™hÃ´te, conserve PCAP, IOC-hunt.

La doc Gatewatcher rappelle aussi quâ€™ils ont un moteur dÃ©diÃ© de dÃ©tection de shellcode (en plus des rÃ¨gles ET) â€” utile pour croiser les signaux.  ï¿¼

â¸»

Â« Un problÃ¨me dâ€™utiliser SMB2 ? Â»

Court : non, SMB2/3 câ€™est le standard moderne. Le vrai problÃ¨me, câ€™est SMBv1 (Ã  bannir). IdÃ©alement, vise SMB 3.1.1 avec signatures et chiffrement.  ï¿¼ ï¿¼

Bonnes pratiques (rÃ©sumÃ©)
	â€¢	DÃ©sactiver SMBv1 partout (GPO/Features).  ï¿¼ ï¿¼
	â€¢	PrivilÃ©gier SMB 3.1.1 : nÃ©gocie AES-128-GCM pour la signature/chiffrement (mieux perf et sÃ©curitÃ©).  ï¿¼
	â€¢	Activer la signature SMB (au moins) et le chiffrement sur les partages sensibles.  ï¿¼
	â€¢	Patch management : vuln. SMBGhost (CVE-2020-0796) touchait SMBv3 (compression) â†’ systÃ¨mes Ã  jour impÃ©ratifs.  ï¿¼ ï¿¼
	â€¢	Segmentation/ACL : pas dâ€™SMB hors LAN, filtrer 445/TCP, pas dâ€™accÃ¨s invitÃ©/anonymous, Kerberos/NTLMv2 only.

â¸»

Si tu me donnes lâ€™alerte exacte (SID, IP/ports, sens) ou un extrait PCAP, je te fais le triage pas-Ã -pas et, si câ€™est du bruit, je te propose la rÃ¨gle de suppression Gatewatcher/Suricata adaptÃ©e.